// Generated by delombok at Thu Jul 04 12:27:09 CEST 2024
package no.nav.melosys.eessi.service.saksrelasjon;

import java.util.List;
import java.util.Optional;

import no.nav.melosys.eessi.integration.sak.Sak;
import no.nav.melosys.eessi.models.BucType;
import no.nav.melosys.eessi.models.FagsakRinasakKobling;
import no.nav.melosys.eessi.repository.FagsakRinasakKoblingRepository;
import no.nav.melosys.eessi.service.sak.ArkivsakService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
public class SaksrelasjonService {
    @java.lang.SuppressWarnings("all")
    private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(SaksrelasjonService.class);
    private final FagsakRinasakKoblingRepository fagsakRinasakKoblingRepository;
    private final ArkivsakService arkivsakService;

    @Transactional
    public FagsakRinasakKobling lagreKobling(Long gsakSaksnummer, String rinaSaksnummer, BucType bucType) {
        var fagsakRinasakKobling = new FagsakRinasakKobling();
        fagsakRinasakKobling.setRinaSaksnummer(rinaSaksnummer);
        fagsakRinasakKobling.setGsakSaksnummer(gsakSaksnummer);
        fagsakRinasakKobling.setBucType(bucType);
        return fagsakRinasakKoblingRepository.save(fagsakRinasakKobling);
    }

    @Transactional
    public void slettVedRinaId(String rinaSaksnummer) {
        fagsakRinasakKoblingRepository.deleteByRinaSaksnummer(rinaSaksnummer);
    }

    public List<FagsakRinasakKobling> finnVedGsakSaksnummer(Long gsakSaksnummer) {
        return fagsakRinasakKoblingRepository.findAllByGsakSaksnummer(gsakSaksnummer);
    }

    public List<FagsakRinasakKobling> finnVedGsakSaksnummerOgBucType(Long gsakSaksnummer, BucType bucType) {
        return fagsakRinasakKoblingRepository.findAllByGsakSaksnummerAndBucType(gsakSaksnummer, bucType);
    }

    /**
     * Finner melosys-sak tilknyttet rina-sak lagret i egen DB
     */
    public Optional<FagsakRinasakKobling> finnVedRinaSaksnummer(String rinaSaksnummer) {
        return fagsakRinasakKoblingRepository.findByRinaSaksnummer(rinaSaksnummer);
    }

    public Optional<Long> søkEtterSaksnummerFraRinaSaksnummer(String rinaSaksnummer) {
        return fagsakRinasakKoblingRepository.findByRinaSaksnummer(rinaSaksnummer).map(FagsakRinasakKobling::getGsakSaksnummer);
    }

    public Optional<String> finnAktørIDTilhørendeRinasak(String rinaSaksnummer) {
        return finnArkivsakForRinaSaksnummer(rinaSaksnummer).map(Sak::getAktoerId);
    }

    public Optional<Sak> finnArkivsakForRinaSaksnummer(String rinaSaksnummer) {
        return finnVedRinaSaksnummer(rinaSaksnummer).map(FagsakRinasakKobling::getGsakSaksnummer).map(arkivsakService::hentsak);
    }

    @java.lang.SuppressWarnings("all")
    public SaksrelasjonService(final FagsakRinasakKoblingRepository fagsakRinasakKoblingRepository, final ArkivsakService arkivsakService) {
        this.fagsakRinasakKoblingRepository = fagsakRinasakKoblingRepository;
        this.arkivsakService = arkivsakService;
    }
}
