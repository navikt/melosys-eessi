// Generated by delombok at Thu Jul 04 12:27:09 CEST 2024
package no.nav.melosys.eessi.metrikker;

import java.util.EnumMap;
import java.util.List;
import java.util.Map;
import no.nav.melosys.eessi.models.kafkadlq.QueueType;
import no.nav.melosys.eessi.models.metrikker.KafkaDLQAntall;
import no.nav.melosys.eessi.repository.KafkaDLQRepository;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

@Component
public class DLQMetrikkerCache {
    @java.lang.SuppressWarnings("all")
    private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(DLQMetrikkerCache.class);
    private final Map<QueueType, Long> queueSizeMap = new EnumMap<>(QueueType.class);
    private final KafkaDLQRepository kafkaDLQRepositoy;

    @Scheduled(fixedRate = 30000)
    public void oppfriskDLQTypeOgAntall() {
        log.debug("Oppfrisker antall DLQ per type");
        queueSizeMap.clear();
        List<KafkaDLQAntall> kafkaDLQTypeOgAntall = kafkaDLQRepositoy.countDLQByQueueType();
        for (KafkaDLQAntall count : kafkaDLQTypeOgAntall) {
            queueSizeMap.put(count.getQueueType(), count.getAntall());
        }
    }

    public double getQueueSize(QueueType queueType) {
        return queueSizeMap.getOrDefault(queueType, 0L);
    }

    @java.lang.SuppressWarnings("all")
    public DLQMetrikkerCache(final KafkaDLQRepository kafkaDLQRepositoy) {
        this.kafkaDLQRepositoy = kafkaDLQRepositoy;
    }
}
